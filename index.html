<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ВашСайт Фото•Видео — демо</title>
  <meta name="description" content="Демо-сайт галереи фото и видео — готовый статический SPA" />
  <!-- Tailwind play CDN for quick demo (suitable for prototypes / static hosting) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel in-browser to allow JSX for demo (not for production builds) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Minimal page styles */
    body { -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    /* make the masonry look nicer in browsers without CSS columns gap support */
    .columns-1 > article { break-inside: avoid; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <div id="root"></div>

  <!-- App script (JSX) -->
  <script type="text/babel">
  const { useEffect, useRef, useState } = React;

  function genId() { return Math.random().toString(36).slice(2,9); }

  function App(){
    const [items, setItems] = useState([]);
    const [query, setQuery] = useState('');
    const [filter, setFilter] = useState('all');
    const [uploadOpen, setUploadOpen] = useState(false);
    const [uploadFiles, setUploadFiles] = useState([]);
    const [uploadMeta, setUploadMeta] = useState({ title:'', desc:'', tags:'', privacy:'public', scheduled: '' });
    const [lightbox, setLightbox] = useState(null);
    const fileRef = useRef(null);

    useEffect(()=>{
      if(items.length===0){
        const demo = [
          { id: genId(), type: 'image', src: 'https://placekitten.com/1200/800', thumb: 'https://placekitten.com/600/400', title: 'Котик у окна', desc: 'Утренний свет', tags: ['кот','утро'], privacy:'public', views:12, likes:3, createdAt: new Date().toISOString() },
          { id: genId(), type: 'image', src: 'https://picsum.photos/1200/900?random=2', thumb: 'https://picsum.photos/600/450?random=2', title: 'Город', desc: 'Вечерняя улица', tags: ['город'], privacy:'public', views:7, likes:1, createdAt: new Date().toISOString() },
          { id: genId(), type: 'video', src: 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4', thumb: 'https://picsum.photos/600/400?random=3', title: 'Короткое видео', desc: 'Test video', tags: ['природа'], privacy:'public', views:4, likes:0, createdAt: new Date().toISOString() }
        ];
        setItems(demo);
      }
    },[]);

    function onFilesSelected(e){
      const files = Array.from(e.target.files || []);
      const mapped = files.map(f => ({ file: f, preview: URL.createObjectURL(f), type: f.type.startsWith('video') ? 'video' : 'image' }));
      setUploadFiles(s => s.concat(mapped));
    }

    function onDrop(e){
      e.preventDefault();
      const files = Array.from(e.dataTransfer.files || []);
      const mapped = files.map(f => ({ file: f, preview: URL.createObjectURL(f), type: f.type.startsWith('video') ? 'video' : 'image' }));
      setUploadFiles(s => s.concat(mapped));
    }

    function publishUploads(){
      const now = new Date().toISOString();
      const newItems = uploadFiles.map(u => ({
        id: genId(), type: u.type, src: u.preview, thumb: u.preview,
        title: uploadMeta.title || u.file.name, desc: uploadMeta.desc,
        tags: uploadMeta.tags ? uploadMeta.tags.split(',').map(t=>t.trim()).filter(Boolean) : [],
        privacy: uploadMeta.privacy, views:0, likes:0, createdAt: now
      }));
      setItems(s => [...newItems, ...s]);
      setUploadOpen(false);
      setUploadFiles([]);
      setUploadMeta({ title:'', desc:'', tags:'', privacy:'public', scheduled: '' });
      alert('Файлы добавлены в локальную демонстрацию. Для реального хранения нужен backend.');
    }

    function removeUploadPreview(idx){
      setUploadFiles(s => s.filter((_,i)=>i!==idx));
    }

    function openLightbox(item){
      setLightbox(item.id);
      setItems(s => s.map(it => it.id===item.id ? {...it, views: it.views+1 } : it));
    }

    function closeLightbox(){ setLightbox(null); }

    function toggleLike(id){
      setItems(s => s.map(it => it.id===id ? {...it, likes: it.likes+1 } : it));
    }

    function downloadImageWithWatermark(item){
      if(item.type!=='image') return;
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.src = item.src;
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.naturalWidth;
        canvas.height = img.naturalHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img,0,0);
        const text = '© ВашСайт';
        const size = Math.max(16, Math.floor(canvas.width / 30));
        ctx.font = `${size}px serif`;
        ctx.globalAlpha = 0.6;
        ctx.textBaseline = 'bottom';
        const padding = 20;
        ctx.fillStyle = 'white';
        ctx.strokeStyle = 'rgba(0,0,0,0.5)';
        ctx.lineWidth = 3;
        const measured = ctx.measureText(text).width;
        ctx.strokeText(text, canvas.width - padding - measured, canvas.height - padding);
        ctx.fillText(text, canvas.width - padding - measured, canvas.height - padding);
        canvas.toBlob(blob => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = (item.title || 'media') + '.png';
          a.click();
        }, 'image/png');
      };
      img.onerror = () => alert('Не удалось загрузить изображение для скачивания (CORS или ресурс недоступен).');
    }

    const visible = items.filter(it => {
      if(filter==='images' && it.type!=='image') return false;
      if(filter==='videos' && it.type!=='video') return false;
      if(filter==='private' && it.privacy!=='private') return false;
      if(filter==='public' && it.privacy!=='public') return false;
      if(query){
        const q = query.toLowerCase();
        const inText = (it.title + ' ' + it.desc + ' ' + (it.tags||[]).join(' ')).toLowerCase();
        return inText.includes(q);
      }
      return true;
    });

    return (
      <div>
        <header className="bg-white shadow sticky top-0 z-10">
          <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-white font-bold">PV</div>
              <div>
                <div className="font-semibold">ВашСайт Фото•Видео</div>
                <div className="text-xs text-gray-500">Портфолио, дневник, магазин — всё в одном</div>
              </div>
            </div>

            <div className="flex items-center gap-3">
              <input value={query} onChange={e=>setQuery(e.target.value)} placeholder="Поиск по заголовкам и тегам..." className="px-3 py-2 rounded border" />
              <select value={filter} onChange={e=>setFilter(e.target.value)} className="px-3 py-2 rounded border">
                <option value="all">Все</option>
                <option value="images">Только фото</option>
                <option value="videos">Только видео</option>
                <option value="public">Только публичные</option>
                <option value="private">Только приватные</option>
              </select>
              <button onClick={()=>setUploadOpen(true)} className="px-4 py-2 bg-indigo-600 text-white rounded shadow">Загрузить</button>
              <div className="flex items-center gap-2">
                <img src="https://i.pravatar.cc/40" alt="avatar" className="w-8 h-8 rounded-full"/>
                <div className="text-sm">Привет, Пользователь</div>
              </div>
            </div>
          </div>
        </header>

        <main className="max-w-6xl mx-auto px-4 py-6">
          <section className="mb-6">
            <div className="flex items-center justify-between">
              <h2 className="text-xl font-semibold">Галерея</h2>
              <div className="text-sm text-gray-500">Показано: {visible.length} / {items.length}</div>
            </div>
          </section>

          <section>
            <div className="columns-1 sm:columns-2 md:columns-3 gap-4 space-y-4">
              {visible.map(it => (
                <article key={it.id} className="break-inside-avoid rounded overflow-hidden bg-white shadow-sm mb-4">
                  <div className="relative cursor-pointer" onClick={()=>openLightbox(it)}>
                    {it.type==='image' ? (
                      <img src={it.thumb} alt={it.title} className="w-full h-auto object-cover block" />
                    ) : (
                      <div className="w-full h-56 bg-black flex items-center justify-center text-white relative">
                        <video src={it.src} className="w-full h-full object-cover" muted playsInline preload="metadata" />
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none text-3xl">▶</div>
                      </div>
                    )}
                  </div>
                  <div className="p-3">
                    <div className="flex items-center justify-between">
                      <div>
                        <div className="font-medium text-sm">{it.title}</div>
                        <div className="text-xs text-gray-500">{new Date(it.createdAt).toLocaleString()}</div>
                      </div>
                      <div className="text-xs text-gray-500">{it.views} просмотров • {it.likes} ❤</div>
                    </div>
                    <div className="mt-2 text-sm text-gray-700">{it.desc}</div>
                    <div className="mt-2 flex flex-wrap gap-2">
                      {(it.tags||[]).map(t=> <span key={t} className="text-xs px-2 py-1 rounded bg-gray-100">#{t}</span>)}
                    </div>
                  </div>
                </article>
              ))}
            </div>
          </section>
        </main>

        {uploadOpen && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-20">
            <div className="w-full max-w-3xl bg-white rounded p-4 shadow-lg" onDragOver={(e)=>e.preventDefault()} onDrop={onDrop}>
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-lg font-semibold">Загрузить фото и видео</h3>
                <button onClick={()=>setUploadOpen(false)} className="text-gray-600">Закрыть</button>
              </div>
              <div className="border-dashed border-2 border-gray-300 rounded p-4 mb-3">
                <div className="flex items-center gap-4">
                  <input ref={fileRef} type="file" multiple accept="image/*,video/*" onChange={onFilesSelected} className="hidden" />
                  <button onClick={()=>fileRef.current.click()} className="px-3 py-2 bg-indigo-600 text-white rounded">Выбрать файлы</button>
                  <div className="text-sm text-gray-500">Или перетащите файлы сюда. Поддерживаются фото и mp4-видео.</div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <label className="text-xs">Заголовок</label>
                  <input value={uploadMeta.title} onChange={e=>setUploadMeta(m=>({...m,title:e.target.value}))} className="w-full px-3 py-2 border rounded" />
                </div>
                <div>
                  <label className="text-xs">Теги (через запятую)</label>
                  <input value={uploadMeta.tags} onChange={e=>setUploadMeta(m=>({...m,tags:e.target.value}))} className="w-full px-3 py-2 border rounded" />
                </div>
                <div className="md:col-span-2">
                  <label className="text-xs">Описание</label>
                  <textarea value={uploadMeta.desc} onChange={e=>setUploadMeta(m=>({...m,desc:e.target.value}))} className="w-full px-3 py-2 border rounded" />
                </div>
                <div>
                  <label className="text-xs">Приватность</label>
                  <select value={uploadMeta.privacy} onChange={e=>setUploadMeta(m=>({...m,privacy:e.target.value}))} className="w-full px-3 py-2 border rounded">
                    <option value="public">Публично (видно всем)</option>
                    <option value="private">Приватно (только по ссылке и паролю)</option>
                  </select>
                </div>
                <div>
                  <label className="text-xs">Планировать публикацию</label>
                  <input type="datetime-local" value={uploadMeta.scheduled} onChange={e=>setUploadMeta(m=>({...m,scheduled:e.target.value}))} className="w-full px-3 py-2 border rounded" />
                </div>
              </div>

              <div className="mt-4">
                <div className="text-sm font-medium mb-2">Предпросмотр файлов</div>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                  {uploadFiles.map((u, idx) => (
                    <div key={idx} className="bg-gray-50 p-2 rounded relative">
                      <button onClick={()=>removeUploadPreview(idx)} className="absolute top-1 right-1 text-xs bg-white rounded px-1">×</button>
                      {u.type==='image' ? <img src={u.preview} alt="preview" className="w-full h-40 object-cover rounded" /> : <video src={u.preview} className="w-full h-40 object-cover rounded" controls />}
                      <div className="text-xs mt-1">{u.file.name}</div>
                    </div>
                  ))}
                  {uploadFiles.length===0 && <div className="col-span-3 text-sm text-gray-500">Файлы отсутствуют — выберите или перетащите их.</div>}
                </div>
              </div>

              <div className="mt-4 flex items-center justify-between">
                <div className="text-xs text-gray-500">Поддерживаемые форматы: JPG, PNG, MP4. Максимум 2GB (серверная проверка обязательна).</div>
                <div className="flex items-center gap-2">
                  <button onClick={publishUploads} className="px-4 py-2 bg-green-600 text-white rounded" disabled={uploadFiles.length===0}>Опубликовать</button>
                  <button onClick={()=>setUploadOpen(false)} className="px-4 py-2 border rounded">Отмена</button>
                </div>
              </div>

              <div className="mt-3 text-xs text-gray-400">Подсказка: интегрируйте Cloudinary/Cloudflare Images и серверную очередь для транскодинга видео и генерации миниатюр.</div>
            </div>
          </div>
        )}

        {lightbox && (
          <Lightbox item={items.find(i=>i.id===lightbox)} onClose={closeLightbox} onLike={toggleLike} onDownload={downloadImageWithWatermark} />
        )}

        <footer className="mt-8 py-6 text-center text-sm text-gray-500">© {new Date().getFullYear()} ВашСайт — демо. Хостинг: любой static host (Netlify, Vercel, GitHub Pages).</footer>
      </div>
    );
  }

  function Lightbox({ item, onClose, onLike, onDownload }){
    if(!item) return null;
    return (
      <div className="fixed inset-0 z-30 bg-black/70 flex items-center justify-center p-4">
        <div className="max-w-4xl w-full bg-white rounded overflow-hidden shadow-lg">
          <div className="flex items-start gap-4">
            <div className="flex-1 bg-black flex items-center justify-center">
              {item.type==='image' ? <img src={item.src} alt={item.title} className="max-h-[70vh] object-contain" /> : <video src={item.src} controls className="max-h-[70vh] w-full" />}
            </div>
            <aside className="w-80 p-4">
              <div className="flex items-start justify-between">
                <div>
                  <h4 className="font-semibold">{item.title}</h4>
                  <div className="text-xs text-gray-500">{new Date(item.createdAt).toLocaleString()}</div>
                </div>
                <button onClick={onClose} className="text-gray-600">✕</button>
              </div>
              <div className="mt-3 text-sm text-gray-700">{item.desc}</div>
              <div className="mt-3 flex flex-wrap gap-2">{(item.tags||[]).map(t=> <span key={t} className="text-xs bg-gray-100 px-2 py-1 rounded">#{t}</span>)}</div>
              <div className="mt-4 flex gap-2">
                <button onClick={()=>onLike(item.id)} className="px-3 py-2 bg-pink-500 text-white rounded">❤ Нравится</button>
                {item.type==='image' && <button onClick={()=>onDownload(item)} className="px-3 py-2 border rounded">Скачать с водяным знаком</button>}
                <button onClick={() => { try { navigator.share && navigator.share({ title: item.title, text: item.desc, url: item.src }); } catch (e) { alert('Поделиться не поддерживается в этом окружении'); }}} className="px-3 py-2 border rounded">Поделиться</button>
              </div>
              <div className="mt-4 text-xs text-gray-500">Просмотров: {item.views} • Лайков: {item.likes}</div>
              <div className="mt-4 text-xs text-gray-400">Подсказки: добавьте CDN, оптимизацию изображений и фоновые воркеры для транскодинга видео.</div>
            </aside>
          </div>
        </div>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  </script>
</body>
</html>
